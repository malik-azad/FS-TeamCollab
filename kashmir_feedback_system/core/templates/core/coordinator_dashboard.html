<!-- core/templates/core/coordinator_dashboard.html -->
{% extends "core/base.html" %}
{% load static %}

{% block title %}Coordinator Dashboard - {{ department_name }}{% endblock title %}

{% block content %}
<div class="py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-6xl mx-auto"> {# Made it slightly wider for more content #}
        
        <div class="mb-8 p-6 bg-white shadow-lg rounded-xl">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-custom-gray-dark">
                        Coordinator Panel
                    </h1>
                    <p class="mt-1 text-lg text-custom-gray">
                        Welcome, {{ coordinator_name }}!
                    </p>
                    <p class="text-sm text-custom-blue font-medium">
                        Department: {{ department_name }}
                    </p>
                </div>
                <div class="mt-4 md:mt-0">
                    {# TODO: Add relevant coordinator actions here later, e.g., View Department Feedback #}
                </div>
            </div>
        </div>
        
        <!-- Student Management Section -->
        <div class="mt-10">
            <h2 class="text-xl font-semibold text-custom-gray-dark mb-4">Students in {{ department_name }} Department</h2>
            {% if students %}
                <div class="bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-custom-gray-light">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Enrollment ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Full Name</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Email</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Batch Start Year</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for student_user in students %}
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">{{ student_user.username }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">{{ student_user.profile.full_name|default:"N/A" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">{{ student_user.email|default:"N/A" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">{{ student_user.profile.batch_start_year|default:"N/A" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="#" class="text-custom-blue hover:text-custom-blue-dark hover:underline">View Details</a>
                                        {# TODO: Add actions like "Edit Student (limited)", "View Student's Feedback" #}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% else %}
                <div class="bg-white p-6 rounded-lg shadow text-center text-gray-500">
                    No students found in your department.
                </div>
            {% endif %}
        </div>

        <!-- Department Feedback Submissions Section -->
        <div class="mt-12">
            <h2 class="text-xl font-semibold text-custom-gray-dark mb-4">Feedback Submissions of {{ department_name }} Department</h2>
            {% if department_feedback_list %}
                <div class="bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-custom-gray-light">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Student</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Category</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Method</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Anonymous</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-custom-gray-dark uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for fb in department_feedback_list %}
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">{{ fb.timestamp|date:"M d, Y, P" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">
                                        {% if fb.is_anonymous %}
                                            <span class="italic text-gray-500">Anonymous</span>
                                        {% else %}
                                            {{ fb.student.username }} {# Enrollment ID #}
                                            {% if fb.student.profile.full_name %}
                                                ({{ fb.student.profile.full_name }})
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">{{ fb.category.get_name_display }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">{{ fb.get_input_method_display }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-custom-gray">
                                        {% if fb.is_anonymous %}
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Yes</span>
                                        {% else %}
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">No</span>
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="{% url 'core:view_feedback_detail' fb.id %}" class="text-custom-blue hover:text-custom-blue-dark hover:underline">View Details</a>
                                        {# TODO: Coordinator might have delete rights for their department's feedback #}
                                        <!-- 
                                        <form action="#" method="POST" class="inline ml-2">
                                            {% csrf_token %}
                                            <button type="submit" class="text-red-600 hover:text-red-800 hover:underline">Delete</button>
                                        </form>
                                        -->
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% else %}
                <div class="bg-white p-6 rounded-lg shadow text-center text-gray-500">
                    No feedback submissions found for your department yet.
                </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock content %}