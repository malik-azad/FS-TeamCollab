<!-- core/templates/core/dashboard_base.html -->
{% extends "core/base.html" %}
{% load static %}

{% block extra_css %}
<style>
    /* Ensure main content block from base has no padding for this layout */
    body > main { padding: 0 !important; }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 260px 1fr;
        height: calc(100vh - 4rem); /* Full height minus top navbar */
    }
    .sidebar { background-color: #f8fafc; border-right: 1px solid #e2e8f0; }
    .sidebar-link {
        display: flex; align-items: center; padding: 0.625rem 1rem; margin: 0 0.75rem;
        border-radius: 0.375rem; color: #475569; font-weight: 500;
        transition: background-color 0.2s, color 0.2s;
    }
    .sidebar-link:hover { background-color: #e2e8f0; color: #1e293b; }
    .sidebar-link.active {
        background-color: var(--color-custom-blue, #0ea5e9); color: white; font-weight: 600;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    .sidebar-link svg { /* THIS IS THE FIX FOR THE ICON SIZE */
        margin-right: 0.75rem; height: 1.25rem; /* 20px */
        width: 1.25rem; /* 20px */ flex-shrink: 0; /* Prevents icon from shrinking */
    }
    
    .main-content-area {
        background-color: #f1f5f9;
        background-image: linear-gradient(rgba(0, 0, 0, 0.02) 1px, transparent 1px), linear-gradient(to right, rgba(0, 0, 0, 0.02) 1px, transparent 1px);
        background-size: 20px 20px;
    }
    
    /* MODAL STYLES (NOW IN BASE DASHBOARD) */
    #summaryModal .modal-backdrop { transition: opacity 0.3s ease-in-out; }
    #summaryModal .modal-content-inner { transition: all 0.3s ease-in-out; }
    #summaryModal .summary-text ul { list-style-type: disc; padding-left: 1.5rem; margin-top: 0.5rem; }
    #summaryModal .summary-text li { margin-bottom: 0.5rem; }
</style>
{% endblock extra_css %}

{% block content %}
<div class="dashboard-grid">
    <!-- Sidebar -->
    <aside class="sidebar flex flex-col p-4">
        <!-- Profile Section in Sidebar -->
        <div class="p-2 mb-6 border border-gray-200 rounded-lg flex items-center space-x-3">
            {% if request.user.profile.profile_photo %}
                <img src="{{ request.user.profile.profile_photo.url }}" alt="Profile Photo" class="h-10 w-10 rounded-full object-cover">
            {% else %}
                <div class="h-10 w-10 rounded-full bg-custom-blue-light flex items-center justify-center text-custom-blue-darker font-semibold">
                    {{ request.user.username|slice:":1"|upper }}
                </div>
            {% endif %}
            <div>
                <p class="font-semibold text-sm text-custom-gray-dark">{{ request.user.profile.full_name|default:request.user.username }}</p>
                <p class="text-xs text-green-600 font-medium">Online</p>
            </div>
        </div>

        <!-- Navigation Links -->
        <nav class="flex flex-col space-y-1">
            {% if request.user.profile.role == 'COORDINATOR' %}
                <a href="{% url 'core:coordinator_dashboard' %}" class="sidebar-link {% if request.resolver_match.url_name == 'coordinator_dashboard' %}active{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                    <span>Overview</span>
                </a>
                <a href="{% url 'core:manage_students' %}" class="sidebar-link {% if request.resolver_match.url_name == 'manage_students' %}active{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-4.67c.12-.318.232-.656.328-.998V10.5c0-2.994.237-5.91.707-8.757l.477-2.752M6.375 8.875c0-1.034.242-2.033.668-2.942a4.125 4.125 0 00-7.533-2.493c-1.423 1.423-.828 3.535 0 5.032l.09.09a4.125 4.125 0 003.688 1.342c.328-.132.656-.292.956-.464l-.708-.404a1.218 1.218 0 00.562-1.025l.073-.428M6.375 8.875a6.375 6.375 0 014.125-1.547v.003c1.113 0 2.16.285 3.07.786A6.375 6.375 0 0010.5 8.875v.003c0 1.034-.242 2.033-.668 2.942a4.125 4.125 0 007.533 2.493c1.423-1.423.828-3.535 0-5.032l-.09-.09a4.125 4.125 0 00-3.688-1.342c-.328.132-.656.292-.956-.464l-.708-.404a1.218 1.218 0 00-.562-1.025l-.073-.428M9 4.5a.75.75 0 01.75.75v.008a.75.75 0 01-1.5 0V5.25A.75.75 0 019 4.5z" /></svg>
                    <span>Student Management</span>
                </a>
                <a href="{% url 'core:view_department_feedback' %}" class="sidebar-link {% if request.resolver_match.url_name == 'view_department_feedback' %}active{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.322C13.96 15.03 16.5 14.736 18 13.5c1.5-1.236 2.25-3.033 2.25-4.512V5.25A2.25 2.25 0 0018 3H6a2.25 2.25 0 00-2.25 2.25v6.75z" /></svg>
                    <span>Feedback List</span>
                </a>
                <a href="{% url 'core:analytics' %}" class="sidebar-link {% if request.resolver_match.url_name == 'analytics' %}active{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h2.25c1.035 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-2.25a1.875 1.875 0 01-1.875-1.875V8.625zM16.5 4.125c0-1.036.84-1.875 1.875-1.875h2.25C21.496 2.25 22.5 3.254 22.5 4.375v15.375c0 1.121-.904 2.028-2.028 2.028h-2.25a2.028 2.028 0 01-2.028-2.028V4.125z" /></svg>
                    <span>Analytics</span>
                </a>
            {% endif %}
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content-area p-6 sm:p-8 overflow-y-auto">
        {% block dashboard_content %}{% endblock dashboard_content %}
    </main>
</div>

<!-- AI Summary Modal (Now lives in the base dashboard template) -->
<div id="summaryModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
    <!-- Backdrop -->
    <div id="modalBackdrop" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop opacity-0"></div>
    <!-- Modal Content -->
    <div class="relative w-full max-w-2xl bg-white rounded-lg shadow-xl modal-content-inner transform scale-95 opacity-0">
        <div class="flex items-start justify-between p-5 border-b rounded-t">
            <h3 class="text-xl font-semibold text-gray-900">AI-Generated Summary</h3>
            <button type="button" id="closeModalBtn" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
        </div>
        <div id="modalBody" class="p-6 space-y-6"></div>
    </div>
</div>
{% endblock content %}

{% block extra_scripts %}
<script>
// Global modal control functions
const modal = document.getElementById('summaryModal');
const modalBackdrop = document.getElementById('modalBackdrop');
const closeModalBtn = document.getElementById('closeModalBtn');
const modalContentInner = document.querySelector('#summaryModal .modal-content-inner');
const modalBody = document.getElementById('modalBody');

function showModal() {
    if (!modal) return;
    modal.classList.remove('hidden');
    setTimeout(() => { // Start transitions
        modalBackdrop.classList.remove('opacity-0');
        modalContentInner.classList.remove('scale-95', 'opacity-0');
    }, 10);
}

function hideModal() {
    if (!modal) return;
    modalBackdrop.classList.add('opacity-0');
    modalContentInner.classList.add('scale-95', 'opacity-0');
    setTimeout(() => {
        modal.classList.add('hidden');
    }, 300); // Wait for transition to finish
}

if (closeModalBtn && modalBackdrop) {
    closeModalBtn.addEventListener('click', hideModal);
    modalBackdrop.addEventListener('click', hideModal);
}

// Any page-specific JS will be injected in the block below
</script>
{% block page_specific_scripts %}{% endblock page_specific_scripts %}
{% endblock extra_scripts %}